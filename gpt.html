<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ISLM</title>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/annotations.js"></script>
</head>
<body>
  <div id="container" style="width: 600px; height: 400px;"></div>

  <label for="M">M:</label>
  <input type="number" id="M">

  <label for="P">P:</label>
  <input type="number" id="P">

  <label for="Y">Y:</label>
  <input type="number" id="Y">
  <br>
  <label for="sLY">sLY:</label>
  <input type="number" id="sLY">

  <label for="sLr">sLr:</label>
  <input type="number" id="sLr">

  <label for="aD">aD:</label>
  <input type="number" id="aD">

  <button onclick="updateChart()">Update</button>

  <div id="coordinates"></div>

  <script>
    var initial_M = 1000;
    var initial_P = 10;
    var initial_Y = 200;
    var initial_sLY = 7;
    var initial_sLr = 10;
    var initial_aD = 150;

    var chart = Highcharts.chart('container', {
      title: {
        text: 'Money Market'
      },
      xAxis: {
        title: {
          text: 'Real Money Balances'
        }
      },
      yAxis: {
        title: {
          text: 'Real Interest Rate'
        }
      },
      series: [{
        name: 'Money Supply',
        data: []
      }, {
        name: 'Money Demand',
        data: []
      }],
      annotations: [{
        labels: [{
          point: {
            x: initial_M / initial_P,
            y: initial_sLY * initial_Y - initial_sLr * (initial_M / initial_P) + initial_aD,
            xAxis: 0,
            yAxis: 0
          },
          text: 'Intersection'
        }]
      }]
    });

    function money_supply(M, P) {
      var data_ms = [];

      for (var i = 0; i <= 1000; i += 0.1) {
        data_ms.push([M / P, i]);
      }

      return data_ms;
    }

    function money_demand(Y, sLr, sLY, aD) {
      var data_md = [];

      for (var i = 0; i <= 100; i += 0.1) {
        var md = sLY * Y - sLr * i + aD;
        if (md < 0) {
          break;
        }
        data_md.push([i, md]);
      }

      return data_md;
    }

    function updateChart() {
      var M = parseFloat(document.getElementById("M").value);
      var P = parseFloat(document.getElementById("P").value);
      var Y = parseFloat(document.getElementById("Y").value);
      var sLY = parseFloat(document.getElementById("sLY").value);
      var sLr = parseFloat(document.getElementById("sLr").value);
      var aD = parseFloat(document.getElementById("aD").value);
      var data_ms = money_supply(M, P);
      var data_md = money_demand(Y, sLr, sLY, aD);
      chart.series[0].setData(data_ms);
      chart.series[1].setData(data_md);

      // Update the annotation position
      chart.annotations[0].labels[0].point.x = M / P;
      chart.annotations[0].labels[0].point.y = sLY * Y - sLr * (M / P) + aD;
      chart.redraw();

      // Update the coordinates display
      document.getElementById("coordinates").innerText = `Intersection Coordinates: X = ${M / P}, Y = ${sLY * Y - sLr * (M / P) + aD}`;
    }

    // Set initial values on page load
    document.getElementById("M").value = initial_M;
    document.getElementById("P").value = initial_P;
    document.getElementById("Y").value = initial_Y;
    document.getElementById("sLY").value = initial_sLY;
    document.getElementById("sLr").value = initial_sLr;
    document.getElementById("aD").value = initial_aD;

    // Update the chart immediately after setting initial values
    updateChart();
  </script>
</body>
</html>